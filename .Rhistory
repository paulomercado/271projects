#express in bps
data.pc <- data_filtered[ , -ncol(data_filtered)] *100
#Loading dataset
setwd("D:/School/ADMU/M AMF/SEM 2/271.7")
data=read.csv("rates.csv")
#Fixing Date
data$Date <- as.Date(data$Date, format = "%m/%d/%Y")
dates <- data$Date
#get dy
data_diff <- data.frame(lapply(data[ , sapply(data, is.numeric)], diff))
data_diff$Date <- dates[-1]
#filter
data_filtered <- subset(data_diff, Date <= as.Date("1996-12-31"))
#express in bps
data.pc <- data_filtered[ , -ncol(data_filtered)] *100
names(data.pc)
#perform PCA on scaled data
pc1 = prcomp(data.pc, scale=T)
summary(pc1)
plot(pc1, type="l")
pc1$rotation
#get cashflows of portfolio
CF <- matrix(c(
5, 105, 0,   0,   0,   # 2Y
5, 5, 105,   0,   0,   # 3Y
-5,-5, -5,  -5, -105    # 5Y
), nrow=3, byrow=TRUE)
total_CF <- colSums(CF)
# PV
y <- 0.05
years <- 1:5
DF <- exp(-y*years)
# Present value of each cash flow: Bi = CF * DF
Bi <- total_CF * DF
BiTi <- -Bi * years/10000  # in bps
weights = c(0,0,1,1,1,1,1,0,0,0)
a1 <- (weights * pc1$rotation[ , "PC1"])[weights != 0]
a2 <- (weights * pc1$rotation[ , "PC2"])[weights != 0]
a3 <- (weights * pc1$rotation[ , "PC3"])[weights != 0]
f1 <- sum(a1*BiTi)
f2 <- sum(a2*BiTi)
f3 <- sum(a3*BiTi)
VaR1 <- qnorm(0.95)*(f1^2)*pc1$sdev[1]^2
VaR2 <- qnorm(0.95)*((f1^2)*pc1$sdev[1]^2+(f2^2)*pc1$sdev[2]^2)
VaR3 <- qnorm(0.95)*((f1^2)*pc1$sdev[1]^2+(f2^2)*pc1$sdev[2]^2+(f3^2)*pc1$sdev[3]^2)
#backtesting using 1997 data
backtestdata <- subset(data, Date > as.Date("1996-12-31"))[, 3:7]
backtestdates <- dates[dates > as.Date("1997-01-02")] #diff makes first day nan
backtestdata.diff <- data.frame(lapply(backtestdata[ , sapply(backtestdata, is.numeric)], diff))/100 #in bps
#using bond duration to calculate change in bond price i.e dB=B*D*dy=sum(BiTi)*dy
dailyPL <- as.matrix(backtestdata.diff) %*% BiTi
backtest_results <- data.frame(
Date = backtestdates,
dailyPL = dailyPL,
exceed_1 = dailyPL < -VaR1,
exceed_2 = dailyPL < -VaR2,
exceed_3 = dailyPL < -VaR3
)
colSums(backtest_results[ , 3:5])/length(backtestdates) # % of days where VaR has been breached
summary(pc1)
#Loading dataset
setwd("D:/School/ADMU/M AMF/SEM 2/271.7")
data=read.csv("rates.csv")
#Fixing Date
data$Date <- as.Date(data$Date, format = "%m/%d/%Y")
dates <- data$Date
#get dy
data_diff <- data.frame(lapply(data[ , sapply(data, is.numeric)], diff))
data_diff$Date <- dates[-1]
#filter
data_filtered <- subset(data_diff, Date <= as.Date("1996-12-31"))
#express in bps
data.pc <- data_filtered[ , -ncol(data_filtered)] *10000
names(data.pc)
#perform PCA on scaled data
pc1 = prcomp(data.pc, scale=T)
summary(pc1)
plot(pc1, type="l")
pc1$rotation
#get cashflows of portfolio
CF <- matrix(c(
5, 105, 0,   0,   0,   # 2Y
5, 5, 105,   0,   0,   # 3Y
-5,-5, -5,  -5, -105    # 5Y
), nrow=3, byrow=TRUE)
total_CF <- colSums(CF)
# PV
y <- 0.05
years <- 1:5
DF <- exp(-y*years)
# Present value of each cash flow: Bi = CF * DF
Bi <- total_CF * DF
BiTi <- -Bi * years/10000  # in bps
weights = c(0,0,1,1,1,1,1,0,0,0)
a1 <- (weights * pc1$rotation[ , "PC1"])[weights != 0]
a2 <- (weights * pc1$rotation[ , "PC2"])[weights != 0]
a3 <- (weights * pc1$rotation[ , "PC3"])[weights != 0]
f1 <- sum(a1*BiTi)
f2 <- sum(a2*BiTi)
f3 <- sum(a3*BiTi)
VaR1 <- qnorm(0.95)*(f1^2)*pc1$sdev[1]^2
VaR2 <- qnorm(0.95)*((f1^2)*pc1$sdev[1]^2+(f2^2)*pc1$sdev[2]^2)
VaR3 <- qnorm(0.95)*((f1^2)*pc1$sdev[1]^2+(f2^2)*pc1$sdev[2]^2+(f3^2)*pc1$sdev[3]^2)
#backtesting using 1997 data
backtestdata <- subset(data, Date > as.Date("1996-12-31"))[, 3:7]
backtestdates <- dates[dates > as.Date("1997-01-02")] #diff makes first day nan
backtestdata.diff <- data.frame(lapply(backtestdata[ , sapply(backtestdata, is.numeric)], diff))/100 #in bps
#using bond duration to calculate change in bond price i.e dB=B*D*dy=sum(BiTi)*dy
dailyPL <- as.matrix(backtestdata.diff) %*% BiTi
backtest_results <- data.frame(
Date = backtestdates,
dailyPL = dailyPL,
exceed_1 = dailyPL < -VaR1,
exceed_2 = dailyPL < -VaR2,
exceed_3 = dailyPL < -VaR3
)
colSums(backtest_results[ , 3:5])/length(backtestdates) # % of days where VaR has been breached
summary(pc1)
#Loading dataset
setwd("D:/School/ADMU/M AMF/SEM 2/271.7")
data=read.csv("rates.csv")
#Fixing Date
data$Date <- as.Date(data$Date, format = "%m/%d/%Y")
dates <- data$Date
#get dy
data_diff <- data.frame(lapply(data[ , sapply(data, is.numeric)], diff))
data_diff$Date <- dates[-1]
#filter
data_filtered <- subset(data_diff, Date <= as.Date("1996-12-31"))
#express in bps
data.pc <- data_filtered[ , -ncol(data_filtered)] *100
names(data.pc)
#perform PCA on scaled data
pc1 = prcomp(data.pc)
summary(pc1)
plot(pc1, type="l")
pc1$rotation
#get cashflows of portfolio
CF <- matrix(c(
5, 105, 0,   0,   0,   # 2Y
5, 5, 105,   0,   0,   # 3Y
-5,-5, -5,  -5, -105    # 5Y
), nrow=3, byrow=TRUE)
total_CF <- colSums(CF)
# PV
y <- 0.05
years <- 1:5
DF <- exp(-y*years)
# Present value of each cash flow: Bi = CF * DF
Bi <- total_CF * DF
BiTi <- -Bi * years/10000  # in bps
weights = c(0,0,1,1,1,1,1,0,0,0)
a1 <- (weights * pc1$rotation[ , "PC1"])[weights != 0]
a2 <- (weights * pc1$rotation[ , "PC2"])[weights != 0]
a3 <- (weights * pc1$rotation[ , "PC3"])[weights != 0]
f1 <- sum(a1*BiTi)
f2 <- sum(a2*BiTi)
f3 <- sum(a3*BiTi)
VaR1 <- qnorm(0.95)*(f1^2)*pc1$sdev[1]^2
VaR2 <- qnorm(0.95)*((f1^2)*pc1$sdev[1]^2+(f2^2)*pc1$sdev[2]^2)
VaR3 <- qnorm(0.95)*((f1^2)*pc1$sdev[1]^2+(f2^2)*pc1$sdev[2]^2+(f3^2)*pc1$sdev[3]^2)
#backtesting using 1997 data
backtestdata <- subset(data, Date > as.Date("1996-12-31"))[, 3:7]
backtestdates <- dates[dates > as.Date("1997-01-02")] #diff makes first day nan
backtestdata.diff <- data.frame(lapply(backtestdata[ , sapply(backtestdata, is.numeric)], diff))/100 #in bps
#using bond duration to calculate change in bond price i.e dB=B*D*dy=sum(BiTi)*dy
dailyPL <- as.matrix(backtestdata.diff) %*% BiTi
backtest_results <- data.frame(
Date = backtestdates,
dailyPL = dailyPL,
exceed_1 = dailyPL < -VaR1,
exceed_2 = dailyPL < -VaR2,
exceed_3 = dailyPL < -VaR3
)
colSums(backtest_results[ , 3:5])/length(backtestdates) # % of days where VaR has been breached
summary(pc1)
#Loading dataset
setwd("D:/School/ADMU/M AMF/SEM 2/271.7")
data=read.csv("rates.csv")
#Fixing Date
data$Date <- as.Date(data$Date, format = "%m/%d/%Y")
dates <- data$Date
#get dy
data_diff <- data.frame(lapply(data[ , sapply(data, is.numeric)], diff))
data_diff$Date <- dates[-1]
#filter
data_filtered <- subset(data_diff, Date <= as.Date("1996-12-31"))
#express in bps
data.pc <- data_filtered[ , -ncol(data_filtered)] *10000
names(data.pc)
#perform PCA on scaled data
pc1 = prcomp(data.pc)
summary(pc1)
plot(pc1, type="l")
pc1$rotation
#get cashflows of portfolio
CF <- matrix(c(
5, 105, 0,   0,   0,   # 2Y
5, 5, 105,   0,   0,   # 3Y
-5,-5, -5,  -5, -105    # 5Y
), nrow=3, byrow=TRUE)
total_CF <- colSums(CF)
# PV
y <- 0.05
years <- 1:5
DF <- exp(-y*years)
# Present value of each cash flow: Bi = CF * DF
Bi <- total_CF * DF
BiTi <- -Bi * years/10000  # in bps
weights = c(0,0,1,1,1,1,1,0,0,0)
a1 <- (weights * pc1$rotation[ , "PC1"])[weights != 0]
a2 <- (weights * pc1$rotation[ , "PC2"])[weights != 0]
a3 <- (weights * pc1$rotation[ , "PC3"])[weights != 0]
f1 <- sum(a1*BiTi)
f2 <- sum(a2*BiTi)
f3 <- sum(a3*BiTi)
VaR1 <- qnorm(0.95)*(f1^2)*pc1$sdev[1]^2
VaR2 <- qnorm(0.95)*((f1^2)*pc1$sdev[1]^2+(f2^2)*pc1$sdev[2]^2)
VaR3 <- qnorm(0.95)*((f1^2)*pc1$sdev[1]^2+(f2^2)*pc1$sdev[2]^2+(f3^2)*pc1$sdev[3]^2)
#backtesting using 1997 data
backtestdata <- subset(data, Date > as.Date("1996-12-31"))[, 3:7]
backtestdates <- dates[dates > as.Date("1997-01-02")] #diff makes first day nan
backtestdata.diff <- data.frame(lapply(backtestdata[ , sapply(backtestdata, is.numeric)], diff))/100 #in bps
#using bond duration to calculate change in bond price i.e dB=B*D*dy=sum(BiTi)*dy
dailyPL <- as.matrix(backtestdata.diff) %*% BiTi
backtest_results <- data.frame(
Date = backtestdates,
dailyPL = dailyPL,
exceed_1 = dailyPL < -VaR1,
exceed_2 = dailyPL < -VaR2,
exceed_3 = dailyPL < -VaR3
)
colSums(backtest_results[ , 3:5])/length(backtestdates) # % of days where VaR has been breached
summary(pc1)
# Load data
# library(readxl)
setwd("D:/School/ADMU/M AMF/SEM 2/271.7")
data=read.csv("rates.csv")
rates.all$Date = as.Date(rates.all$Date)
# Load data
# library(readxl)
setwd("D:/School/ADMU/M AMF/SEM 2/271.7")
rates.all=read.csv("rates.csv")
rates.all$Date = as.Date(rates.all$Date)
# filter out backtesting and train dfs
rates = rates.all[1:1752, -1]
backtest = rates.all[1753:nrow(rates.all),]
# Select relevant columns (1Yr to 5Yr)
rates = rates[, c("1Yr", "2Yr", "3Yr", "4Yr", "5Yr")]
# Load data
# library(readxl)
setwd("D:/School/ADMU/M AMF/SEM 2/271.7")
rates.all=read.csv("rates.csv")
rates.all$Date = as.Date(rates.all$Date)
# filter out backtesting and train dfs
rates = rates.all[1:1752, -1]
backtest = rates.all[1753:nrow(rates.all),]
# Select relevant columns (1Yr to 5Yr)
rates = rates[, c("x1Yr", "x2Yr", "x3Yr", "x4Yr", "x5Yr")]
View(data_filtered)
# Load data
# library(readxl)
setwd("D:/School/ADMU/M AMF/SEM 2/271.7")
rates.all=read.csv("rates.csv")
rates.all$Date = as.Date(rates.all$Date)
# filter out backtesting and train dfs
rates = rates.all[1:1752, -1]
backtest = rates.all[1753:nrow(rates.all),]
# Select relevant columns (1Yr to 5Yr)
rates = rates[, c("X1Yr", "X2Yr", "X3Yr", "X4Yr", "X5Yr")]
backtest = backtest[,c("X1Yr", "X2Yr", "X3Yr", "X4Yr", "X5Yr")]
# PCA on non-differenced data
# scale = FALSE
pc.rates = prcomp(rates, scale = FALSE)
summary(pc.rates)
# get loadings and stdev
pc.rates$sdev * 10000
pc.rates$rotation
# PCA AND VAR on diffed data
# Compute daily changes in rates
rates.diff = diff(as.matrix(rates))
rates.diff
pc.rates.diff = prcomp(rates.diff, scale = FALSE)
summary(pc.rates.diff)
# Loadings and stdev
loadings.diff = pc.rates.diff$rotation
stdev.diff = pc.rates.diff$sdev * 10000
loadings.diff
stdev.diff
# Define portfolio cash flows
B1 = c(5, 105, 0, 0, 0)
B2 = c(5,5,105,0,0)
B3 = c(-5,-5,-5,-5,-105)
cf.df = data.frame(
Bond1 = B1,
Bond2 = B2,
Bond3 = B3
)
cf.df$cf = rowSums(cf.df)
y = 0.05
years = 1:5
cf.df$dcf = cf.df$cf/(1+y)^years
cf.df
dcf = cf.df$dcf
# compute sensitivity to 1bp change and to factors
sens.1bp = dcf / 10000 * 1:5
sens.1bp.factors = sens.1bp %*% loadings.diff
sens.1bp.factors
# Compute standard deviation of portfolio changes using 1, 2, and 3 factors
stdev1 = sqrt((sens.1bp.factors[1]*stdev.diff[1])^2)
stdev2 = sqrt((sens.1bp.factors[1]*stdev.diff[1])^2 + (sens.1bp.factors[2]*stdev.diff[2])^2)
stdev3 = sqrt((sens.1bp.factors[1]*stdev.diff[1])^2 + (sens.1bp.factors[2]*stdev.diff[2])^2 + (sens.1bp.factors[2]*stdev.diff[2])^2)
stdev1
stdev2
stdev3
# Compute 1-day 95% VaR
VaR1 = qnorm(0.95) * stdev1
VaR2 = qnorm(0.95) * stdev2
VaR3 = qnorm(0.95) * stdev3
VaR1
VaR2
VaR3
# BACKTESTING
backtest.diff = diff(as.matrix(backtest))
# Compute actual portfolio changes
port.change = backtest.diff %*% dcf
# Compare actual losses with VaR over the first 100 trading days
backtest_results = data.frame(
Day = 1:99,
value_change = port.change[1:99],
VaR1 = -VaR1,
VaR2 = -VaR2,
VaR3 = -VaR3,
exceed_count1 = port.change[1:99] < -VaR1,
exceed_count2 = port.change[1:99] < -VaR2,
exceed_count3 = port.change[1:99] < -VaR3
)
backtest_results
# Compute exceedance rates
out1 = sum(backtest_results$exceed_count1) / 99
out2 = sum(backtest_results$exceed_count2) / 99
out3 = sum(backtest_results$exceed_count3) / 99
out1
out2
out3
sens.1bp.factors[1]
f1
# Load data
# library(readxl)
setwd("D:/School/ADMU/M AMF/SEM 2/271.7")
rates.all=read.csv("rates.csv")
rates.all$Date = as.Date(rates.all$Date)
# filter out backtesting and train dfs
rates = rates.all[1:1752, -1]
backtest = rates.all[1753:nrow(rates.all),]
# Select relevant columns (1Yr to 5Yr)
rates = rates[, c("X1Yr", "X2Yr", "X3Yr", "X4Yr", "X5Yr")]
backtest = backtest[,c("X1Yr", "X2Yr", "X3Yr", "X4Yr", "X5Yr")]
# PCA on non-differenced data
# scale = FALSE
pc.rates = prcomp(rates, scale = FALSE)
summary(pc.rates)
# get loadings and stdev
pc.rates$sdev * 10000
pc.rates$rotation
# PCA AND VAR on diffed data
# Compute daily changes in rates
rates.diff = diff(as.matrix(rates))
rates.diff
pc.rates.diff = prcomp(rates.diff, scale = FALSE)
summary(pc.rates.diff)
# Loadings and stdev
loadings.diff = pc.rates.diff$rotation
stdev.diff = pc.rates.diff$sdev * 10000
loadings.diff
stdev.diff
# Define portfolio cash flows
B1 = c(5, 105, 0, 0, 0)
B2 = c(5,5,105,0,0)
B3 = c(-5,-5,-5,-5,-105)
cf.df = data.frame(
Bond1 = B1,
Bond2 = B2,
Bond3 = B3
)
cf.df$cf = rowSums(cf.df)
y = 0.05
years = 1:5
cf.df$dcf = cf.df$cf*exp(-y*years)
cf.df
dcf = cf.df$dcf
# compute sensitivity to 1bp change and to factors
sens.1bp = dcf / 10000 * 1:5
sens.1bp.factors = sens.1bp %*% loadings.diff
sens.1bp.factors
# Compute standard deviation of portfolio changes using 1, 2, and 3 factors
stdev1 = sqrt((sens.1bp.factors[1]*stdev.diff[1])^2)
stdev2 = sqrt((sens.1bp.factors[1]*stdev.diff[1])^2 + (sens.1bp.factors[2]*stdev.diff[2])^2)
stdev3 = sqrt((sens.1bp.factors[1]*stdev.diff[1])^2 + (sens.1bp.factors[2]*stdev.diff[2])^2 + (sens.1bp.factors[2]*stdev.diff[2])^2)
stdev1
stdev2
stdev3
# Compute 1-day 95% VaR
VaR1 = qnorm(0.95) * stdev1
VaR2 = qnorm(0.95) * stdev2
VaR3 = qnorm(0.95) * stdev3
VaR1
VaR2
VaR3
# BACKTESTING
backtest.diff = diff(as.matrix(backtest))
# Compute actual portfolio changes
port.change = backtest.diff %*% dcf
# Compare actual losses with VaR over the first 100 trading days
backtest_results = data.frame(
Day = 1:99,
value_change = port.change[1:99],
VaR1 = -VaR1,
VaR2 = -VaR2,
VaR3 = -VaR3,
exceed_count1 = port.change[1:99] < -VaR1,
exceed_count2 = port.change[1:99] < -VaR2,
exceed_count3 = port.change[1:99] < -VaR3
)
backtest_results
# Compute exceedance rates
out1 = sum(backtest_results$exceed_count1) / 99
out2 = sum(backtest_results$exceed_count2) / 99
out3 = sum(backtest_results$exceed_count3) / 99
out1
out2
out3
sens.1bp.factors[1]
loadings.diff
summary(pc.rates.diff)
sens.1bp
dcf
Bi
a1
sens.1bp.factors
f1
loadings.diff
pc1$rotation
pc.rates.diff
summary(pc.rates.diff)
length(backtestdates)
#Loading dataset
setwd("D:/School/ADMU/M AMF/SEM 2/271.7")
data=read.csv("rates.csv")
#Fixing Date
data$Date <- as.Date(data$Date, format = "%m/%d/%Y")
dates <- data$Date
#get dy
data_diff <- data.frame(lapply(data[ , sapply(data, is.numeric)], diff))
data_diff$Date <- dates[-1]
#filter
data_filtered <- subset(data_diff, Date <= as.Date("1996-12-31"))
#express in bps
data.pc <- data_filtered[ , -ncol(data_filtered)] *10000
names(data.pc)
#perform PCA on scaled data
pc1 = prcomp(data.pc)
summary(pc1)
plot(pc1, type="l")
pc1$rotation
#get cashflows of portfolio
CF <- matrix(c(
5, 105, 0,   0,   0,   # 2Y
5, 5, 105,   0,   0,   # 3Y
-5,-5, -5,  -5, -105    # 5Y
), nrow=3, byrow=TRUE)
total_CF <- colSums(CF)
# PV
y <- 0.05
years <- 1:5
DF <- exp(-y*years)
# Present value of each cash flow: Bi = CF * DF
Bi <- total_CF * DF
BiTi <- -Bi * years/10000  # in bps
weights = c(0,0,1,1,1,1,1,0,0,0)
a1 <- (weights * pc1$rotation[ , "PC1"])[weights != 0]
a2 <- (weights * pc1$rotation[ , "PC2"])[weights != 0]
a3 <- (weights * pc1$rotation[ , "PC3"])[weights != 0]
f1 <- sum(a1*BiTi)
f2 <- sum(a2*BiTi)
f3 <- sum(a3*BiTi)
sd1 <- sqrt((f1^2)*pc1$sdev[1]^2)
sd2 <- sqrt(((f1^2)*pc1$sdev[1]^2+(f2^2)*pc1$sdev[2]^2))
sd3 <- sqrt(((f1^2)*pc1$sdev[1]^2+(f2^2)*pc1$sdev[2]^2+(f3^2)*pc1$sdev[3]^2))
VaR1 <- qnorm(0.95)*sd1
VaR2 <- qnorm(0.95)*sd2
VaR3 <- qnorm(0.95)*sd3
#backtesting using 1997 data
backtestdata <- subset(data, Date > as.Date("1996-12-31"))[, 3:7]
backtestdates <- dates[dates > as.Date("1997-01-02")] #diff makes first day nan
backtestdata.diff <- data.frame(lapply(backtestdata[ , sapply(backtestdata, is.numeric)], diff))*10000 #in bps
#using bond duration to calculate change in bond price i.e dB=B*D*dy=sum(BiTi)*dy
dailyPL <- as.matrix(backtestdata.diff) %*% BiTi
backtest_results <- data.frame(
Date = backtestdates,
dailyPL = dailyPL,
exceed_1 = dailyPL < -VaR1,
exceed_2 = dailyPL < -VaR2,
exceed_3 = dailyPL < -VaR3
)
colSums(backtest_results[ , 3:5])/length(backtestdates) # % of days where VaR has been breached
