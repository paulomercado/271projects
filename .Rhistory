b
B
colnames(B)= c(0,1,2,3,4)
B
B =matrix(rbind(c(50/1000,950/1000,0,0,0),c((950-874)/950,0,874/950,0,0),c((874-769)/874,0,0,769/874,0),c((769-615)/769,0,0,0,615/769),c(1,0,0,0,0)),nrow=5,)
B1 = c(0,1,2,3,4)
rownames(B) = B1
colnames(B)= B1
#b
B2 = B%^%100000
#Get expected
B2[1,]%*%B1
#c
B2[1,1]*40
B2[1,1]*40*2
B1
B
B2
C=matrix(rbind(c(1,0,0,0),c(0.2,0.30,0.5,0),c(0,0.2,0.3,0.5),c(0,0,0,1)),nrow=4)
C1 = c(37,38,39,40)
rownames(C) = C1
colnames(C)= C1
#b
C%^%4
#c
C1-38
C[2,]%*%C2
#c
C2=C1-38
C[2,]%*%C2
C2
C
C1
##3
#a
C=matrix(rbind(c(1,0,0,0),c(0.2,0.30,0.5,0),c(0,0.2,0.3,0.5),c(0,0,0,1)),nrow=4)
C1 = c(37,38,39,40)
rownames(C) = C1
colnames(C)= C1
#b
C2=C%^%4
C2[2,1]
#c
C3=C1-38
C2[2,]%*%C3
C2
library(expm)
##1
#a
A=matrix(rbind(c(0.6,0.08,0.2,0.12),c(0.15,0.40,0.25,0.20),c(0.25,0.16,0.5,0.09),c(0.28,0.12,0.2,0.4)),nrow=4)
A1=A%^%3 #after 3 periods
MarketShare=c(0.4,0.2,0.3,0.1)
MarketShare %*% A1
#b
A2 = A%^%1000 #long run
##2
#a
B =matrix(rbind(c(50/1000,950/1000,0,0,0),c((950-874)/950,0,874/950,0,0),c((874-769)/874,0,0,769/874,0),c((769-615)/769,0,0,0,615/769),c(1,0,0,0,0)),nrow=5,)
B1 = c(0,1,2,3,4)
rownames(B) = B1
colnames(B)= B1
B
#b
B2 = B%^%100000
B2
#Get expected
B2[1,]%*%B1
#c
B2[1,1]*40
B2[1,1]*40*2
##3
#a
C=matrix(rbind(c(1,0,0,0),c(0.2,0.30,0.5,0),c(0,0.2,0.3,0.5),c(0,0,0,1)),nrow=4)
C1 = c(37,38,39,40)
rownames(C) = C1
colnames(C)= C1
#b
C2=C%^%4
C2[2,1]
#c
C3=C1-38
C2[2,]%*%C3
library(expm)
##1
#a
A=matrix(rbind(c(0.6,0.08,0.2,0.12),c(0.15,0.40,0.25,0.20),c(0.25,0.16,0.5,0.09),c(0.28,0.12,0.2,0.4)),nrow=4)
A1=A%^%3 #after 3 periods
MarketShare=c(0.4,0.2,0.3,0.1)
MarketShare %*% A1
#b
A2 = A%^%1000 #long run
##2
#a
B =matrix(rbind(c(50/1000,950/1000,0,0,0),c((950-874)/950,0,874/950,0,0),c((874-769)/874,0,0,769/874,0),c((769-615)/769,0,0,0,615/769),c(1,0,0,0,0)),nrow=5,)
B1 = c(0,1,2,3,4)
rownames(B) = B1
colnames(B)= B1
B
#b
B2 = B%^%100000
B2
#Get expected
B2[1,]%*%B1
#c
B2[1,1]*40
B2[1,1]*40*2
##3
#a
C=matrix(rbind(c(1,0,0,0),c(0.2,0.30,0.5,0),c(0,0.2,0.3,0.5),c(0,0,0,1)),nrow=4)
C1 = c(37,38,39,40)
rownames(C) = C1
colnames(C)= C1
#b
C2=C%^%4
C2[2,1]+C2[2,4]
#c
C3=C1-38
C2[2,]%*%C3
View(A2)
library(expm)
##1
#a
A=matrix(rbind(c(0.6,0.08,0.2,0.12),c(0.15,0.40,0.25,0.20),c(0.25,0.16,0.5,0.09),c(0.28,0.12,0.2,0.4)),nrow=4)
A1=A%^%3 #after 3 periods
MarketShare=c(0.4,0.2,0.3,0.1)
MarketShare %*% A1
#b
A2 = A%^%1000 #long run
##2
#a
B =matrix(rbind(c(50/1000,950/1000,0,0,0),c((950-874)/950,0,874/950,0,0),c((874-769)/874,0,0,769/874,0),c((769-615)/769,0,0,0,615/769),c(1,0,0,0,0)),nrow=5,)
B1 = c(0,1,2,3,4)
rownames(B) = B1
colnames(B)= B1
B
#b
B2 = B%^%100000
B2
#Get expected
B2[1,]%*%B1
#c
B2[1,1]*40
B2[1,1]*40*2
##3
#a
C=matrix(rbind(c(1,0,0,0),c(0.2,0.30,0.5,0),c(0,0.2,0.3,0.5),c(0,0,0,1)),nrow=4)
C1 = c(37,38,39,40)
rownames(C) = C1
colnames(C)= C1
#b
C2=C%^%4
C2[2,1]+C2[2,4]
#c
C3=C1-38
C2[2,]%*%C3
#Get expected
B2[1,]%*%c(1,2,3,4,5)
View(B)
View(B2)
B2[1,1]
1/B2[1,1]
B1+1
#Get expected
c(50/1000,(950-874)/1000,(874-769)/1000,(769-615)/1000,615/1000)%*%(B1+1)
#c
B2[1,1]*40
B2[1,1]*40*2
c2
C2
C2[2,1]+C2[2,4]
C2[2,]%*%C3
library(expm)
##1
#a
A=matrix(rbind(c(0.6,0.08,0.2,0.12),c(0.15,0.40,0.25,0.20),c(0.25,0.16,0.5,0.09),c(0.28,0.12,0.2,0.4)),nrow=4)
A1=A%^%3 #after 3 periods
MarketShare=c(0.4,0.2,0.3,0.1)
MarketShare %*% A1
#b
A2 = A%^%1000 #long run
##2
#a
B =matrix(rbind(c(50/1000,950/1000,0,0,0),c((950-874)/950,0,874/950,0,0),c((874-769)/874,0,0,769/874,0),c((769-615)/769,0,0,0,615/769),c(1,0,0,0,0)),nrow=5,)
B1 = c(0,1,2,3,4)
rownames(B) = B1
colnames(B)= B1
B
#b
B2 = B%^%100000
B2
#Get expected
#c
B2[1,1]*40
B2[1,1]*40*2
##3
#a
C=matrix(rbind(c(1,0,0,0),c(0.2,0.30,0.5,0),c(0,0.2,0.3,0.5),c(0,0,0,1)),nrow=4)
C1 = c(37,38,39,40)
rownames(C) = C1
colnames(C)= C1
#b
C2=C%^%4
C2[2,1]+C2[2,4]
#c
C3=C1-38
C2[2,]%*%C3
View(B2)
1/B2[1,1]
#load dataset
data=read.csv("rates.csv")
data[["Date"]] <- as.Date(data[["Date"]], format = "%m/%d/%Y")
data_filtered <- data[data[["Date"]] <= as.Date("1996-12-31"), ]
#load dataset
data=read.csv("rates.csv")
#load dataset
data=read.csv("rates.csv")
#load dataset
data=read.csv("~/Desktop/School/M AMF/SEM 2/271.7projects/rates.csv)
data[["Date"]] <- as.Date(data[["Date"]], format = "%m/%d/%Y")
#load dataset
data=read.csv("~/Desktop/School/M AMF/SEM 2/271.7projects/rates.csv")
data[["Date"]] <- as.Date(data[["Date"]], format = "%m/%d/%Y")
data_filtered <- data[data[["Date"]] <= as.Date("1996-12-31"), ]
#load dataset
data=read.csv("~/Desktop/School/M AMF/SEM 2/271.7projects/rates.csv")
data[["Date"]] <- as.Date(data[["Date"]], format = "%m/%d/%Y")
data_filtered <- data[data[["Date"]] <= as.Date("1996-12-31"), ]
data.pc = data_filtered[-1]
names(data.pc)
data
data.pc
View(data.pc)
data.pc = data_filtered[-1]/100
View(data.pc)
names(data.pc)
#perform PCA on scaled data
pc1 = prcomp(data.pc, scale=T)
summary(pc1)
plot(pc1, type="l")
pc1$rotation
pc1$rotation[,1]
pc1$rotation[,2]
#perform PCA on unscaled data
pc1.u = prcomp(data.pc)
summary(pc1.u)
plot(pc1.u, type="l")
pc1.u$rotation[,1]
View(data_filtered)
View(data.pc)
summary(pc1.u)
View(data)
View(data_filtered)
#Loading dataset
setwd("D:/School/ADMU/M AMF/SEM 2/271.7")
#Loading dataset
setwd("'/Users/pjam/Desktop/School/M AMF/SEM 2/271.7projects'")
#Loading dataset
setwd('/Users/pjam/Desktop/School/M AMF/SEM 2/271.7projects')
data=read.csv("rates.csv")
#Loading dataset
setwd('/Users/pjam/Desktop/School/M AMF/SEM 2/271.7projects')
data=read.csv("rates.csv")
#Fixing Date
data$Date <- as.Date(data$Date, format = "%m/%d/%Y")
dates <- data$Date
#get dy
data_diff <- data.frame(lapply(data[ , sapply(data, is.numeric)], diff))
data_diff$Date <- dates[-1]
#filter
data_filtered <- subset(data_diff, Date <= as.Date("1996-12-31"))
#express in bps
data.pc <- data_filtered[ , -ncol(data_filtered)] *10000
names(data.pc)
#perform PCA on scaled data
pc1 = prcomp(data.pc)
summary(pc1)
plot(pc1, type="l")
pc1$rotation
#get cashflows of portfolio
CF <- matrix(c(
5, 105, 0,   0,   0,   # 2Y
5, 5, 105,   0,   0,   # 3Y
-5,-5, -5,  -5, -105    # 5Y
), nrow=3, byrow=TRUE)
total_CF <- colSums(CF)
# PV
y <- 0.05
years <- 1:5
DF <- exp(-y*years)
# Present value of each cash flow: Bi = CF * DF
Bi <- total_CF * DF
BiTi <- -Bi * years/10000  # in bps
weights = c(0,0,1,1,1,1,1,0,0,0)
a1 <- (weights * pc1$rotation[ , "PC1"])[weights != 0]
a2 <- (weights * pc1$rotation[ , "PC2"])[weights != 0]
a3 <- (weights * pc1$rotation[ , "PC3"])[weights != 0]
f1 <- sum(a1*BiTi)
f2 <- sum(a2*BiTi)
f3 <- sum(a3*BiTi)
sd1 <- sqrt((f1^2)*pc1$sdev[1]^2)
sd2 <- sqrt(((f1^2)*pc1$sdev[1]^2+(f2^2)*pc1$sdev[2]^2))
sd3 <- sqrt(((f1^2)*pc1$sdev[1]^2+(f2^2)*pc1$sdev[2]^2+(f3^2)*pc1$sdev[3]^2))
VaR1 <- qnorm(0.95)*sd1
VaR2 <- qnorm(0.95)*sd2
VaR3 <- qnorm(0.95)*sd3
#backtesting using 1997 data
backtestdata <- subset(data, Date > as.Date("1996-12-31"))[, 3:7]
backtestdates <- dates[dates > as.Date("1997-01-02")] #diff makes first day nan
backtestdata.diff <- data.frame(lapply(backtestdata[ , sapply(backtestdata, is.numeric)], diff))*10000 #in bps
#using bond duration to calculate change in bond price i.e dB=B*D*dy=sum(BiTi)*dy
dailyPL <- as.matrix(backtestdata.diff) %*% BiTi
backtest_results <- data.frame(
Date = backtestdates,
dailyPL = dailyPL,
exceed_1 = dailyPL < -VaR1,
exceed_2 = dailyPL < -VaR2,
exceed_3 = dailyPL < -VaR3
)
colSums(backtest_results[ , 3:5])/length(backtestdates) # % of days where VaR has been breached
VaR1
VaR2
VaR3
dailyPL
backtestdata.diff
#backtesting using 1997 data
backtestdata <- subset(data, Date > as.Date("1996-12-31"))[, 4:8]
backtestdata.diff <- data.frame(lapply(backtestdata[ , sapply(backtestdata, is.numeric)], diff))*10000 #in bps
#Loading dataset
setwd('/Users/pjam/Desktop/School/M AMF/SEM 2/271.7projects')
data=read.csv("rates.csv")
#Fixing Date
data$Date <- as.Date(data$Date, format = "%m/%d/%Y")
dates <- data$Date
#get dy
data_diff <- data.frame(lapply(data[ , sapply(data, is.numeric)], diff))
data_diff$Date <- dates[-1]
#filter
data_filtered <- subset(data_diff, Date <= as.Date("1996-12-31"))
#express in bps
data.pc <- data_filtered[ , -ncol(data_filtered)] *10000
names(data.pc)
#perform PCA on scaled data
pc1 = prcomp(data.pc)
summary(pc1)
plot(pc1, type="l")
pc1$rotation
#get cashflows of portfolio
CF <- matrix(c(
5, 105, 0,   0,   0,   # 2Y
5, 5, 105,   0,   0,   # 3Y
-5,-5, -5,  -5, -105    # 5Y
), nrow=3, byrow=TRUE)
total_CF <- colSums(CF)
# PV
y <- 0.05
years <- 1:5
DF <- exp(-y*years)
# Present value of each cash flow: Bi = CF * DF
Bi <- total_CF * DF
BiTi <- -Bi * years/10000  # in bps
weights = c(0,0,1,1,1,1,1,0,0,0)
a1 <- (weights * pc1$rotation[ , "PC1"])[weights != 0]
a2 <- (weights * pc1$rotation[ , "PC2"])[weights != 0]
a3 <- (weights * pc1$rotation[ , "PC3"])[weights != 0]
f1 <- sum(a1*BiTi)
f2 <- sum(a2*BiTi)
f3 <- sum(a3*BiTi)
sd1 <- sqrt((f1^2)*pc1$sdev[1]^2)
sd2 <- sqrt(((f1^2)*pc1$sdev[1]^2+(f2^2)*pc1$sdev[2]^2))
sd3 <- sqrt(((f1^2)*pc1$sdev[1]^2+(f2^2)*pc1$sdev[2]^2+(f3^2)*pc1$sdev[3]^2))
VaR1 <- qnorm(0.95)*sd1
VaR2 <- qnorm(0.95)*sd2
VaR3 <- qnorm(0.95)*sd3
#backtesting using 1997 data
backtestdata <- subset(data, Date > as.Date("1996-12-31"))[, 4:8]
backtestdates <- dates[dates > as.Date("1997-01-02")] #diff makes first day nan
backtestdata.diff <- data.frame(lapply(backtestdata[ , sapply(backtestdata, is.numeric)], diff))*10000 #in bps
#using bond duration to calculate change in bond price i.e dB=B*D*dy=sum(BiTi)*dy
dailyPL <- as.matrix(backtestdata.diff) %*% BiTi
backtest_results <- data.frame(
Date = backtestdates,
dailyPL = dailyPL,
exceed_1 = dailyPL < -VaR1,
exceed_2 = dailyPL < -VaR2,
exceed_3 = dailyPL < -VaR3
)
colSums(backtest_results[ , 3:5])/length(backtestdates) # % of days where VaR has been breached
backtestdata.diff
BiTi
dailypL
dailyPL
#Loading dataset
setwd('/Users/pjam/Desktop/School/M AMF/SEM 2/271.7projects')
data=read.csv("rates.csv")
#Fixing Date
data$Date <- as.Date(data$Date, format = "%m/%d/%Y")
dates <- data$Date
#get dy
data_diff <- data.frame(lapply(data[ , sapply(data, is.numeric)], diff))
data_diff$Date <- dates[-1]
#filter
data_filtered <- subset(data_diff, Date <= as.Date("1996-12-31"))
#express in bps
data.pc <- data_filtered[ , -ncol(data_filtered)] *10000
names(data.pc)
#perform PCA on scaled data
pc1 = prcomp(data.pc)
summary(pc1)
plot(pc1, type="l")
pc1$rotation
#get cashflows of portfolio
CF <- matrix(c(
5, 105, 0,   0,   0,   # 2Y
5, 5, 105,   0,   0,   # 3Y
-5,-5, -5,  -5, -105    # 5Y
), nrow=3, byrow=TRUE)
total_CF <- colSums(CF)
# PV
y <- 0.05
years <- 1:5
DF <- exp(-y*years)
# Present value of each cash flow: Bi = CF * DF
Bi <- total_CF * DF
BiTi <- -Bi * years/10000  # in bps
weights = c(0,0,1,1,1,1,1,0,0,0)
a1 <- (weights * pc1$rotation[ , "PC1"])[weights != 0]
a2 <- (weights * pc1$rotation[ , "PC2"])[weights != 0]
a3 <- (weights * pc1$rotation[ , "PC3"])[weights != 0]
f1 <- sum(a1*BiTi)
f2 <- sum(a2*BiTi)
f3 <- sum(a3*BiTi)
sd1 <- sqrt((f1^2)*pc1$sdev[1]^2)
sd2 <- sqrt(((f1^2)*pc1$sdev[1]^2+(f2^2)*pc1$sdev[2]^2))
sd3 <- sqrt(((f1^2)*pc1$sdev[1]^2+(f2^2)*pc1$sdev[2]^2+(f3^2)*pc1$sdev[3]^2))
VaR1 <- qnorm(0.95)*sd1
VaR2 <- qnorm(0.95)*sd2
VaR3 <- qnorm(0.95)*sd3
#backtesting using 1997 data
backtestdata <- subset(data, Date > as.Date("1996-12-31"))[, 4:8]
backtestdates <- dates[dates > as.Date("1997-01-02")] #diff makes first day nan
backtestdata.diff <- data.frame(lapply(backtestdata[ , sapply(backtestdata, is.numeric)], diff))*10000 #in bps
#using bond duration to calculate change in bond price i.e dB=B*D*dy=sum(BiTi)*dy
dailyPL <- as.matrix(backtestdata.diff) %*% BiTi
backtest_results <- data.frame(
Date = backtestdates,
dailyPL = dailyPL,
exceed_1 = dailyPL <= -VaR1,
exceed_2 = dailyPL <= -VaR2,
exceed_3 = dailyPL <= -VaR3
)
colSums(backtest_results[ , 3:5])/length(backtestdates) # % of days where VaR has been breached
dailyPL
#Loading dataset
setwd('/Users/pjam/Desktop/School/M AMF/SEM 2/271.7projects')
data=read.csv("rates.csv")
#Fixing Date
data$Date <- as.Date(data$Date, format = "%m/%d/%Y")
dates <- data$Date
#get dy
data_diff <- data.frame(lapply(data[ , sapply(data, is.numeric)], diff))
data_diff$Date <- dates[-1]
#filter
data_filtered <- subset(data_diff, Date <= as.Date("1996-12-31"))
#express in bps
data.pc <- data_filtered[ , -ncol(data_filtered)] *10000
names(data.pc)
#perform PCA on scaled data
pc1 = prcomp(data.pc)
summary(pc1)
plot(pc1, type="l")
pc1$rotation
#get cashflows of portfolio
CF <- matrix(c(
5, 105, 0,   0,   0,   # 2Y
5, 5, 105,   0,   0,   # 3Y
-5,-5, -5,  -5, -105    # 5Y
), nrow=3, byrow=TRUE)
total_CF <- colSums(CF)
# PV
y <- 0.05
years <- 1:5
DF <- exp(-y*years)
# Present value of each cash flow: Bi = CF * DF
Bi <- total_CF * DF
BiTi <- -Bi * years/10000  # in bps
weights = c(0,0,1,1,1,1,1,0,0,0)
a1 <- (weights * pc1$rotation[ , "PC1"])[weights != 0]
a2 <- (weights * pc1$rotation[ , "PC2"])[weights != 0]
a3 <- (weights * pc1$rotation[ , "PC3"])[weights != 0]
f1 <- sum(a1*BiTi)
f2 <- sum(a2*BiTi)
f3 <- sum(a3*BiTi)
sd1 <- sqrt((f1^2)*pc1$sdev[1]^2)
sd2 <- sqrt(((f1^2)*pc1$sdev[1]^2+(f2^2)*pc1$sdev[2]^2))
sd3 <- sqrt(((f1^2)*pc1$sdev[1]^2+(f2^2)*pc1$sdev[2]^2+(f3^2)*pc1$sdev[3]^2))
VaR1 <- qnorm(0.95)*sd1
VaR2 <- qnorm(0.95)*sd2
VaR3 <- qnorm(0.95)*sd3
#backtesting using 1997 data
backtestdata <- subset(data, Date > as.Date("1996-12-31"))[, 4:8]
backtestdates <- dates[dates > as.Date("1997-01-02")] #diff makes first day nan
backtestdata.diff <- data.frame(lapply(backtestdata[ , sapply(backtestdata, is.numeric)], diff))*10000 #in bps
#using bond duration to calculate change in bond price i.e dB=B*D*dy=sum(BiTi)*dy
dailyPL <- as.matrix(backtestdata.diff) %*% BiTi
backtest_results <- data.frame(
Date = backtestdates,
dailyPL = dailyPL,
exceed_1 = dailyPL >= VaR1,
exceed_2 = dailyPL >= VaR2,
exceed_3 = dailyPL >= VaR3
)
colSums(backtest_results[ , 3:5])/length(backtestdates) # % of days where VaR has been breached
